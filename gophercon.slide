Gophercon Brasil 2024
04 Junho

Gi√°como Quinalia 
giacomo.quinalia@gmail.com

Bruno Spolavori
bruno.spolavori@ixcsoft.com.br

* bit.ly/ixcgo
.image images/bit.ly_ixcgo.png 600 600

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
.caption por [[https://www.youtube.com/watch?v=Ki69rMAnkv4][Wesley Willians]]

N√£o apenas uma linguagem: uma plataforma end-to-end.

- Promessa de compatibilidade: nunca haver√° a vers√£o 2.0
- Testes
- Formata√ß√£o
- Gerenciamento de depend√™ncias nativo
- Profiling
- Seguran√ßa
- go command

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem

Mais receita, Menos custos, Menos riscos.

Empresas precisam escalar suas opera√ß√µes

- *performance*

Velocidade na entrega de suas solu√ß√µes

- *simplicidade*

Economizar com infraestrutura

- *efici√™ncia*

Necessidade de aplica√ß√µes seguras

- *seguran√ßa*

: Projetos open-source usando Go

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
.image images/go_is.png

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
.image images/companies_using_go_1.png 200 700
.image images/cloud__and_open_source.png 300 800

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
Mercado livre
.image images/mercado_livre_languages_stats.png 500 850

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
Mercado livre
.image images/mercado_livre_languages_predict.png 540 840

: * Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
: .image images/go_complete_platform.png

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
.image images/total_go_users.png

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
.image images/expect_use_languages.png 600 800

*
.background images/last_year_languages_used.png

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
.image images/users_satisfaction.png 400 900
.html users_satisfaction.html

: * Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
: .image images/jetbrains_salary_trends.png 600 900

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
.image images/language_comparison_1.png

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
.image images/language_comparison_2.png

* Go no Mundo Real: Empresas, Carreiras e Futuro da Linguagem
.image images/language_comparison_3.png

* Perguntas?
.image images/any_questions_2.png

* Comparando Threads: Threads convencionais vs a inova√ß√£o de Go

Threads OS:
 - Syscall
 - Troca de contexto, atualizar registradores com dados da memoria
 - Custa aproximadamente 4MB de ram

Green Threads ou Go Routines
- Compara√ß√£o entre outras linguagens e Golang 

* Perguntas?
.image images/any_questions_1.png

* Conhecendo a "log/slog": A biblioteca de log da Standard Library do Go
.caption por [[https://www.youtube.com/watch?v=xszQjCqLX6w][Andr√© Leoni]]

Logs estruturados com slog

- Performance
- Uso de mem√≥ria
- Extensibilidade

sirupsen/logrus (23.8k‚≠êÔ∏è)
uber-go/zap (20.5k‚≠êÔ∏è) 
rs/zerolog (9.4k‚≠êÔ∏è)

* Conhecendo a "log/slog": A biblioteca de log da Standard Library do Go
Arquitetura
.image images/slog_arch_1.png 450 900

* Conhecendo a "log/slog": A biblioteca de log da Standard Library do Go
Arquitetura
.image images/slog_arch_2.png 450 900

* Conhecendo a "log/slog": A biblioteca de log da Standard Library do Go
Arquitetura
.image images/slog_arch_3.png 450 900

* Conhecendo a "log/slog": A biblioteca de log da Standard Library do Go

N√≠veis

    const (
        LevelDebug Level = -4
        LevelInfo  Level = 0
        LevelWarn  Level = 4
        LevelError Level = 8
    )

- Levels s√£o inteiros
- Espa√ßos para que possa ser criado levels customizados
- Info √© o level padr√£o

* Conhecendo a "log/slog": A biblioteca de log da Standard Library do Go
Text handler
.play text_logger.go /^//START/,/^//END/

* Conhecendo a "log/slog": A biblioteca de log da Standard Library do Go
JSON handler
.play json_logger.go /^//START/,/^//END/

* Conhecendo a "log/slog": A biblioteca de log da Standard Library do Go
With
.play logger_with.go /^//START/,/^//END/

* Conhecendo a "log/slog": A biblioteca de log da Standard Library do Go
Group
.play logger_group.go /^//START/,/^//END/

* Conhecendo a "log/slog": A biblioteca de log da Standard Library do Go
.image images/slog_zap.png 500 900

* Uma Experi√™ncia de Desenvolvimento de Software Embarcado com GoLang
.caption por [[https://youtu.be/FSK-i0goCGs?si=A14UxTUjgk0Sl1re][Matheus Deodato]]

- Desafios semelhantes aos nossos com as cameras, porem com hardware proprietario
- OpenWRT
- Estudaram o uso de C, C++, Rust, Python (Interpletado e Compilado) e Lua
 
Aproximadamente 2200 clientes com 6000 c√¢meras apontadas para a rua
2000 c√¢meras internas. Totalizando 190.000 usu√°rios finais.

* Uma Experi√™ncia de Desenvolvimento de Software Embarcado com GoLang
.caption por [[https://youtu.be/FSK-i0goCGs?si=A14UxTUjgk0Sl1re][Matheus Deodato]]

Problemas:
 - Restri√ß√µes de Hardware
 - Problemas com os Chineses (API, Documenta√ß√£o)
 - Converter RTSP para WebRTC
 - Monitoramento & Tunelamento 


Sulu√ß√µes com Go:
 - Go Routines
 - Channels
 - Implementa protocolos de comunica√ß√£o baixo nivel
 - Facil de compilar
 - Tem cara de C

* Uma Experi√™ncia de Desenvolvimento de Software Embarcado com GoLang
.caption por [[https://youtu.be/FSK-i0goCGs?si=A14UxTUjgk0Sl1re][Matheus Deodato]]
.image images/Embarcados_FirstSetup.jpg

* Uma Experi√™ncia de Desenvolvimento de Software Embarcado com GoLang
.caption por [[https://youtu.be/FSK-i0goCGs?si=A14UxTUjgk0Sl1re][Matheus Deodato]]
.image images/Embarcados_FinalSetup.jpg

* Uma Experi√™ncia de Desenvolvimento de Software Embarcado com GoLang
.caption por [[https://youtu.be/FSK-i0goCGs?si=A14UxTUjgk0Sl1re][Matheus Deodato]]
.image images/Embarcados_Hardware.jpg

* GoIoT: Inovando na Conectividade com Go e Dispositivos Inteligentes
.caption por [[https://www.youtube.com/watch?v=ICqv5jJYLEA][Rafael Mateus]]


    Experi√™ncia com IoT na Industria, Modbus, EtherCAT

Vantagens:
 - Concorrencia nativa (Go routines e Channels)
 - Baixo consumo de Recursos
 - Facil de compilar o mesmo codigo em diversos processadores
 - Periph.io



* GoIoT: Inovando na Conectividade com Go e Dispositivos Inteligentes
.caption por [[https://www.youtube.com/watch?v=ICqv5jJYLEA&][Rafael Mateus]]

.image images/tinygo.png
TinyGo:
 - Plataforma Go para desenvolvimento em embarcados
 - Compila para microprocessadores, PIC, AVR (Arduino), GBA
 - Implementa nativamente Protocolos de comunica√ß√£o de baixo nivel, I2C, SPI, UART
 - Tem ferramentas para realizar o flash nos dispositivos suportados

* GoIoT: Inovando na Conectividade com Go e Dispositivos Inteligentes
.caption por [[https://www.youtube.com/watch?v=ICqv5jJYLEA&][Rafael Mateus]]
 
Hello World
 - Golang > 1.9Mb 
 - TinyGo > 251Mb

Hello World sem debugger
 - Golang > 837Kb 
 - TinyGo > 10Kb

E √© possivel reduzir mais!

* Servi√ßos que Fofocam: Desvendando a Magia do Serf em Go

    O Problema:
    Resolver a resolu√ß√£o de nomes na borda da Vercel em 10ms

- Serf, protolo da hashcorp, para gossip
- DNS distribuido
- Golang

* Resolvendo Desafios de Live Streaming em Go

Streaming
- Encodifica√ß√£o do Video
- Inser√ß√£o dinamica de an√∫ncios
- Armazenamento distribu√≠do de arquivos pr√©-processados


Live streaming
- Encodifica√ß√£o em tempo real
- Legendas em tempo real
- Regras de negocio em tempo real
- Diversas programa√ß√µes com regras de negocio diferentes
- Latencia, bit rate 

    Gopher play

* Mitigando CVEs de aplica√ß√µes Golang em produ√ß√£o
.caption por [[https://youtu.be/dFfnVehb5TQ?si=XmZxzBvqwWaZ2t_3][Amim Knabben e Juliana Gaioso]]

- Weakness, Platform & Vulnerability (CWE, CVE, CPE)
- Metodos de pontua√ß√£o, CVSS & EPSS
- Software Bill Of Materials
- SLSA & GitOps

Software Suply Chain
- Verifica√ß√£o de vulnerabilidades durante toda a cadeia de desenvolvimento
- Registries
- Bibliotecas externas
- Ambiente de desenvolvimento
- Ambiente de build

Golang j√° possui SBOM


* Profile-Guided Optimization

T√©cnica de otimiza√ß√£o do compilador

- CPU profiling & Memory profiling
- Destinado para ambiente de produ√ß√£o
- 2-14% em melhora de performance

Workflow

- Compilar e lan√ßar um bin√°rio inicial (sem PGO).
- Coletar profile de ambiente de produ√ß√£o.
- Quando chegar a hora de lan√ßar um bin√°rio atualizado, compilar a partir da fonte mais recente e fornecer o profile de produ√ß√£o.
- Voltar ao passo 2

* Profile-Guided Optimization

    package main

    import "runtime/pprof"

    func main() {
        f, err := os.Create("cpu-profile.pprof")
        if err != nil {
            fmt.Println("Tratem os erros :)", err)
            return
        }
        
        pprof.StartCPUProfile(f)
        defer pprof.StopCPUProfile()

        someWork()
    }

* Profile-Guided Optimization

    package main
    
    import (
        "net/http"
        _ "net/http/pprof"
    )

    func main() {
        f, err := os.Create("cpu-profile.pprof")
        if err != nil {
            fmt.Println("Tratem os erros :)", err)
            return
        }
        
        pprof.StartCPUProfile(f)
        defer pprof.StopCPUProfile()

        http.ListenAndServe(":8090", nil)
    }

* Profile-Guided Optimization

O que ser√° otimizado?

- Inlining hot functions
- Devirtualization
- Escape analysis
- Block Reordering

* Profile-Guided Optimization
Inlining

:
    func add(a, b int) int {
        return a + b
    }

    func main() {
        c := add(1, 2)
    }
:
    func main() {
        a := 1
        b := 2
        c := a + b
    }
:
    func main() {
        c := 1 + 2
    }
:
    func main() {
        c := 3
    }


* Profile-Guided Optimization
Devirtualization

    type Reader interface {
        Read(p []byte) (n int, err error)
    }

    func main() {
        f, _ := os.Open("foo.txt")
        var r io.Reader = f
        r.Read(b)
    }
:
    ...
    
    if f, ok := r.(*os.File); ok {
        f.Read(b)
    } else {
        r.Read(b)
    }

* Profile-Guided Optimization
Block reordering

    if conditionA {
        // Bloco A
        // Acessado com MENOS frequ√™ncia
    } else {
        // Bloco B
        // Acessado com MAIS frequ√™ncia
    }

O PGO pode escolher entre negar a condi√ß√£o A ou testar diretamente a condi√ß√£o B

    if conditionB {
        // Bloco B
        // Acessado com MAIS frequ√™ncia
    } else {
        // Bloco A
        // Acessado com MENOS frequ√™ncia
    }

* Profile-Guided Optimization
Escape analysis


: O que *n√£o* invalida o profile?
: - Altera√ß√µes em um arquivo fora de uma hot function
: - Mover uma fun√ß√£o para outro arquivo do *mesmo* *package*
: O que *invalida* o profile?
: - Mudan√ßas dentro de uma hot function
: - Renomear uma fun√ß√£o
: - Mover uma fun√ß√£o para outro pacote

: .background images/background.png
: .image images/ladder.svg

* Perguntas? 
.image images/any_questions_4.gif

* Construindo Sistemas de Busca Eficientes em Go: Da Simplicidade √† Escala Global

Pesquisa: Um filme do Arnold Shuazineguer

- *Stop* *words*: Remo√ß√£o de termos neutros
- *Normaliza√ß√£o*: Normalizar capitaliza√ß√£o, acentua√ß√£o, etc
- *Tokeniza√ß√£o*: Tokeniza√ß√£o de conte√∫do textual
- *Fuzziness*: similaridade de conte√∫do

* Construindo Sistemas de Busca Eficientes em Go: Da Simplicidade √† Escala Global

Index invertido

.image images/inverted_index.png 450 900

* Construindo Sistemas de Busca Eficientes em Go: Da Simplicidade √† Escala Global

Postgres

    ALTER TABLE movies ADD COLUMN ts_title tsvector
    GENERATED ALWAYS AS (to_tsvector('english', title))
    STORED;

GIN = Generalized Inverted Index

    CREATE INDEX ts_idx ON movies USING GIN (ts_title)
:
Query:

    SELECT to_tsvector('portuguese', 'um filme do arnold')

Resultado:

    'arnold': 4 'film': 2


* Construindo Sistemas de Busca Eficientes em Go: Da Simplicidade √† Escala Global

BleveSearch
: .image images/blevesearch.png

Mapeamento de campos din√¢micos

    mapping := bleve.NewIndexMapping()
    index, err := bleve.New("index.bleve", mapping)
    index, err := bleve.NewMemOnly(mapping)

Mapeamento

    document := bleve.NewDocumentMapping()
    field := bleve.NewTextFieldMapping()
    field.Analyser = "en"
    document.AddFieldMappingsAt("title", field)

    field.Index = false // armazena, mas n√£o indexa
    field.Store = false // n√£o armazena, mas indexa

* Construindo Sistemas de Busca Eficientes em Go: Da Simplicidade √† Escala Global

Index

    type Movie struct {
        Title       string `json:"title"`
        Description string `json:"description"`
    }

    err := index.Index("star-wars", Movie{
        Title:       "Star wars",
        Description: "A long time ago in a galaxy...",
    })

Tipos de busca

    bleve.NewPhraseQuery("arnold schwarzenegger")
    bleve.NewMatchQuery("arnold")
    bleve.NewPrefixQuery("arnold")
    bleve.NewQueryStringQuery("arnold")
    bleve.NewFuzzyQuery("arnoud")
    bleve.NewGeoDistanceQuery(lt,ln,"1km")

* Construindo Sistemas de Busca Eficientes em Go: Da Simplicidade √† Escala Global

Busca

    query := bleve.NewFuzzyQuery("arnold")
    searchRequest := bleve.NewSearchRequest(query)
    results, _ := index.Search(searchRequest)
    for _, result := range results {
        // manipular os resultados (map[string]interface)
    }


* Construindo Sistemas de Busca Eficientes em Go: Da Simplicidade √† Escala Global

E se eu tiver MILH√ïES/BILH√ïES de registros?

- Escrita X Leitura
- Limita√ß√£o f√≠sica

.image images/search_engines.png 350 700

* Construindo Sistemas de Busca Eficientes em Go: Da Simplicidade √† Escala Global

80% Infraestrutura, 15% Experimenta√ß√£o, 5%  C√≥digo
Analisadores complexos demandam processamento üí∏

.image images/sharding.png

* Padr√µes de Concorr√™ncia em Go

Como Go trabalha com concorr√™ncia?

- Goroutines
- Channels

    func main() {
        ch := make(chan string)
        
        go func() {
            ch <- "Hello, world!"
        }()

        fmt.Println(<-ch)
    }

* Generator pattern
.play concurrency_patterns_generator_pattern.go /^//START/,/^//END/

* Worker group
.play concurrency_patterns_worker_group_pattern.go /^//START/,/^//END/

* Pipelines
.play concurrency_patterns_pipeline_pattern.go /^//START/,/^//END/

* Fan-In
.play concurrency_patterns_fanin_pattern.go /^//START/,/^//END/

* Fan-Out
.play concurrency_patterns_generator_pattern.go /^//START/,/^//END/

* Janela Deslizante
.play concurrency_patterns_generator_pattern.go /^//START/,/^//END/

* Processamento em Lote
.play concurrency_patterns_generator_pattern.go /^//START/,/^//END/

* Sistema de Ticket
.play concurrency_patterns_generator_pattern.go /^//START/,/^//END/

* Escolhendo (ou n√£o) o melhor ORM para o seu projeto

ORM √© uma t√©cnica que apresenta uma ponte entre os objetos do nosso dom√≠nio e tabelas de dados relacionais, como o Postgres e MySQL.

Alguns fatores podem influenciar na decis√£o de adotar ou n√£o uma ferramenta de ORM em um projeto.

- Escopo
- Criticidade
- Prazo de entrega
- Volume de dados a serem processados

* Escolhendo (ou n√£o) o melhor ORM para o seu projeto

Vantagens

- Produtividade
- Developer-friendly
- Mecanismos que ajudam a mitigar problemas de seguran√ßa
- Suporte a diferentes bases de dados

Desvantagens

- Condicionam o uso de SELECT * FROM
- Menos controle
- Curva de aprendizado da ferramenta
- SQL n√£o √© uma sub-linguagem
- Falta de flexibilidade para atender queries complexas
- A ferramenta de ORM tamb√©m pode ser burlada

* Escolhendo (ou n√£o) o melhor ORM para o seu projeto

Escrita e execu√ß√£o de queries nativas

- database/sql
- pgx

SQL builders e SQL-First ORMs

- bun
- squirrel

Code-first ORMs

- gorm
- ent

Geradores de c√≥digo Go a partir de queries SQL

- sqlc

* Encrypt, Decrypt and Sign data using Go
.caption por [[https://youtu.be/wf9jVKLRsKo?si=nxoy1RCZzeFjZtlP][Rafael Escrich]]
Hash:
 - Deterministico
 - Efeito avalanche
 - Perda de dados
 - Rapido

 MD5
 SHA
 Argon2

* Encrypt, Decrypt and Sign data using Go
.caption por [[https://youtu.be/wf9jVKLRsKo?si=nxoy1RCZzeFjZtlP][Rafael Escrich]]
Chave Simetrica:
 - Mesma chave encripta e decripta

 AES
 DES
 Twofish

* Encrypt, Decrypt and Sign data using Go
.caption por [[https://youtu.be/wf9jVKLRsKo?si=nxoy1RCZzeFjZtlP][Rafael Escrich]]
Chave Publica:
 - Par de chaves, numeros primos(RSA) ou curva eliptica(ECC)
 - Uma chave privada e uma chave Publica
 - Assinar um dado
 - Encriptar um dado


: * Hexagonal, Clean Architecture ou Domain-Driven Design?
